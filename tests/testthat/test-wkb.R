
test_that("s2latlng can be imported from wkb", {
  # POINT (-64 45)
  wkb_point <- list(as.raw(c(0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                             0x00, 0x00, 0x00, 0x50, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
                             0x46, 0x40)))
  class(wkb_point) <- "wk_wkb"

  expect_identical(
    as.data.frame(s2latlng(wkb_point)),
    data.frame(lat = 45, lng = -64)
  )
})

test_that("s2latlng can be exported to wkb", {
  # SRID=4326;POINT (-64 45)
  wkb_point <- list(as.raw(c(0x01, 0x01, 0x00, 0x00, 0x20, 0xe6, 0x10, 0x00,
                             0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x50, 0xc0, 0x00, 0x00,
                             0x00, 0x00, 0x00, 0x80, 0x46, 0x40)))
  class(wkb_point) <- "wk_wkb"

  expect_identical(as_wkb(s2latlng(45, -64), endian = 1), wkb_point)
  expect_identical(as_wkb(s2latlng(double(), double())[NA]), structure(list(NULL), class = "wk_wkb"))
})

test_that("s2polyline can be imported from wkb", {
  wkb_polyline <- list(as.raw(c(0x01, 0x02, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
                                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x50, 0xc0, 0x00, 0x00,
                                0x00, 0x00, 0x00, 0x80, 0x46, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
                                0x00, 0x20, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4a, 0x40
  )))
  class(wkb_polyline) <- "wk_wkb"

  expect_equal(
    as.data.frame(s2polyline(wkb_polyline)),
    data.frame(lat = c(45, 52), lng = c(-64, 8))
  )
})

test_that("s2polygon can be imported from wkb", {
  wkb_polygon <- list(as.raw(c(0x01, 0x03, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
                               0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
                               0x41, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40, 0x00,
                               0x00, 0x00, 0x00, 0x00, 0x80, 0x46, 0x40, 0x00, 0x00, 0x00, 0x00,
                               0x00, 0x80, 0x46, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e,
                               0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x44, 0x40, 0x00, 0x00,
                               0x00, 0x00, 0x00, 0x00, 0x24, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
                               0x00, 0x34, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x41, 0x40,
                               0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40, 0x04, 0x00, 0x00,
                               0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40, 0x00, 0x00,
                               0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
                               0x80, 0x41, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x41, 0x40,
                               0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, 0x00, 0x00, 0x00,
                               0x00, 0x00, 0x00, 0x34, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                               0x34, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40)))
  class(wkb_polygon) <- "wk_wkb"

  expect_length(s2polyline(s2polygon(wkb_polygon)), 2)
})
